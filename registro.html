<!DOCTYPE html>
<html lang="es">
  <head>
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-5Q94FLN3");
    </script>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Ventas y Clientes - COPYFAST&PRINT</title>
    <meta
      name="description"
      content="Panel de registro interno para clientes, ventas y control de cr茅dito de COPYFAST&PRINT."
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="/favicons/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/favicons/android-icon-192x192.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/favicons/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/favicons/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/favicons/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/favicons/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="/favicons/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="/favicons/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="/favicons/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/favicons/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-icon-180x180.png"
    />

    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/formulario.css" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v6.1.1/css/all.css"
    />
  </head>
  <body>
    <div id="loading-overlay" class="loading-overlay" style="display: none">
      <div class="loader"></div>
      <p>Registrando venta...</p>
    </div>

    <script>
      // Verifica la sesi贸n antes de cargar el contenido
      if (sessionStorage.getItem("sesionActiva") !== "true") {
        window.location.href = "login-registro.html";
      }
    </script>

    <header>
      <nav class="navbar">
        <div class="brand">
          <h2>COPY<span>FAST&</span>PRINT</h2>
        </div>
        <ul class="menu" id="menu">
          <li><a href="admin.html">Admin</a></li>
          <li><a href="registro.html">Registro Ventas</a></li>
          <li><a href="gastos.html">Control de Gastos</a></li>
          <li><a href="#" id="btnCerrarSesion">Cerrar Sesi贸n</a></li>
        </ul>
        <div class="menu-toggle" id="menu_toggle">
          <i class="fas fa-bars" id="toggle_open"></i>
          <i class="fas fa-times" id="toggle_close" style="display: none"></i>
        </div>
      </nav>
    </header>

    <div class="container main-content">
      <div class="form-wrapper">
        <section class="form-section">
          <div class="section-heading">
            <h2> Registro de Venta y Clientes</h2>
            <p>
              Completa los datos de la venta y del cliente para realizar el
              registro.
            </p>
          </div>

          <form id="registro-ventas-form" class="form-grid">
            <div class="form-separator full-width">
              <h3><i class="fas fa-user"></i> Datos del Cliente</h3>
            </div>
            <div class="form-group">
              <label for="cedula">C茅dula / RIF *</label>
              <input type="text" id="cedula" name="cedula" required />
            </div>
            <div class="form-group">
              <label for="nombre">Nombre / Raz贸n Social *</label>
              <input type="text" id="nombre" name="nombre" required />
            </div>
            <div class="form-group">
              <label for="telefono">Tel茅fono *</label>
              <input type="tel" id="telefono" name="telefono" required />
            </div>
            <div class="form-group">
              <label for="email">Email (Opcional)</label>
              <input type="email" id="email" name="email" />
            </div>

            <div class="form-separator full-width">
              <h3><i class="fas fa-receipt"></i> Detalle de la Venta</h3>
            </div>
            <div class="form-group full-width">
              <label for="descripcion"
                >Descripci贸n del Servicio/Producto *</label
              >
              <textarea
                id="descripcion"
                name="descripcion"
                rows="3"
                required
              ></textarea>
            </div>
            <div class="form-group">
              <label for="tipoServicio">Tipo de Servicio</label>
              <select id="tipoServicio" name="tipoServicio">
                <option value="Sublimacion">Sublimaci贸n</option>
                <option value="DTF">DTF</option>
                <option value="Impresion">Impresi贸n/Fotocopia</option>
                <option value="Diseno">Dise帽o Gr谩fico</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="form-group">
              <label for="montoTotal">Monto Total (Bs.) *</label>
              <input
                type="number"
                id="montoTotal"
                name="montoTotal"
                step="0.01"
                min="0.01"
                required
              />
            </div>
            <div class="form-group">
              <label for="montoPagado">Monto Pagado (Bs.) *</label>
              <input
                type="number"
                id="montoPagado"
                name="montoPagado"
                step="0.01"
                min="0"
                required
              />
              <span id="pago-error" class="error-message"></span>
            </div>
            <div class="form-group">
              <label for="metodoPago">M茅todo de Pago *</label>
              <select id="metodoPago" name="metodoPago" required>
                <option value="">Selecciona una</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Transferencia">Transferencia</option>
                <option value="Pago-Movil">Pago M贸vil</option>
                <option value="Tarjeta">Tarjeta</option>
                <option value="Credito">Cr茅dito</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="form-group">
              <label for="fechaVenta">Fecha de Venta *</label>
              <input type="date" id="fechaVenta" name="fechaVenta" required />
            </div>

            <div class="form-group full-width">
              <button type="submit" class="calculate-btn">
                <i class="fas fa-save"></i> Registrar Venta
              </button>
              <button type="reset" class="btn-secondary">
                <i class="fas fa-trash-alt"></i> Limpiar Formulario
              </button>
            </div>
          </form>
        </section>
      </div>

      <div class="info-column">
        <div class="info-box highlight">
          <h3><i class="fas fa-info-circle"></i> Venta a Cr茅dito</h3>
          <p>
            Si el **Monto Pagado** es menor al **Monto Total**, la venta se
            registrar谩 autom谩ticamente como **Venta a Cr茅dito** con el saldo
            pendiente.
          </p>
        </div>

        <div class="info-box info">
          <h3><i class="fas fa-check"></i> Campos Requeridos</h3>
          <p>
            Los campos marcados con un asterisco (<span class="required">*</span
            >) son obligatorios para el registro.
          </p>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-content">
        <h2>COPY<span>FAST&</span>PRINT</h2>
        <h5>Tu Soluci贸n Integral en Impresi贸n y Personalizaci贸n</h5>
      </div>
      <div class="social-networks">
        <a href="https://www.instagram.com/copyfastprint/" target="_blank"
          ><i class="fab fa-instagram"></i
        ></a>
        <a
          href="https://www.facebook.com/profile.php?id=61578120201237"
          target="_blank"
          ><i class="fab fa-facebook"></i
        ></a>
        <a href="https://co.pinterest.com/copyfastprint/" target="_blank"
          ><i class="fab fa-pinterest"></i
        ></a>
        <a href="https://www.tiktok.com/@copyfastprint" target="_blank"
          ><i class="fab fa-tiktok"></i
        ></a>
      </div>
    </footer>

    <a href="#" id="scroll-to-top" class="scroll-to-top">
      <i class="fas fa-chevron-up"></i>
    </a>

    <script src="js/scripts.js"></script>
    <script src="netlify/functions/registrar-venta.js"></script>
    <script>
      // Bot贸n de cerrar sesi贸n
      document
        .getElementById("btnCerrarSesion")
        .addEventListener("click", function (e) {
          e.preventDefault();
          if (confirm("驴Est谩s seguro de que deseas cerrar sesi贸n?")) {
            sessionStorage.clear();
            window.location.href = "login-registro.html";
          }
        });

      // Mostrar nombre del usuario logueado
      const usuario = sessionStorage.getItem("usuario");
      if (usuario) {
        const userInfo = document.createElement("div");
        userInfo.style.cssText =
          "position: fixed; bottom: 20px; right: 20px; background: #fff; padding: 1em; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 999;";
        userInfo.innerHTML = `
          <div style="display: flex; align-items: center; gap: 0.5em;">
            <i class="fas fa-user-circle" style="font-size: 1.5em; color: #c60e0f;"></i>
            <div>
              <strong style="display: block; color: #333;">Usuario: ${usuario}</strong>
              <small style="color: #666;">Sesi贸n iniciada</small>
            </div>
          </div>
        `;
        document.body.appendChild(userInfo);
      }
    </script>
  </body>
</html>
