<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Análisis Anual - COPYFAST&PRINT</title>

    <!-- Favicons -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16x16.png"
    />

    <link rel="stylesheet" href="/admin/css/main.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
      // Configuración Global de Chart.js - Estilo Corporativo (Rojo)
      if (typeof Chart !== 'undefined') {
        Chart.defaults.font.family = "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
        Chart.defaults.color = "#a0a0a0";
        
        // Líneas y Puntos (para gráficos de tendencia)
        Chart.defaults.elements.line.borderColor = "#8b0000";
        Chart.defaults.elements.line.backgroundColor = "rgba(139, 0, 0, 0.2)";
        Chart.defaults.elements.line.tension = 0.4; // Curvas suaves modernas
        
        Chart.defaults.elements.point.backgroundColor = "#8b0000";
        Chart.defaults.elements.point.borderColor = "#fff";
        Chart.defaults.elements.point.hoverBackgroundColor = "#ff0000";
        Chart.defaults.elements.point.radius = 4;
      }
    </script>
  </head>
  <body class="admin-page">
    <div id="loading-overlay" class="loading-overlay" style="display: none">
      <div class="spinner"></div>
      <p>Analizando datos...</p>
    </div>

    <div class="admin-grid-container">
      <aside class="admin-sidebar">
        <div class="sidebar-header">
          <h3>COPY<span>FAST&</span>PRINT</h3>
        </div>
        <nav class="sidebar-nav">
          <ul>
            <li>
              <a href="admin.html"
                ><i class="fas fa-tachometer-alt fa-fw"></i> Dashboard</a
              >
            </li>
            <li>
              <a href="ventas.html"
                ><i class="fas fa-dollar-sign fa-fw"></i> Ventas</a
              >
            </li>
            <li>
              <a href="gastos.html"
                ><i class="fas fa-file-invoice-dollar fa-fw"></i> Gastos</a
              >
            </li>
            <li>
              <a href="clientes.html"
                ><i class="fas fa-users fa-fw"></i> Clientes</a
              >
            </li>
            <li>
              <a href="inventario.html"
                ><i class="fas fa-box-open fa-fw"></i> Inventario</a
              >
            </li>
            <li>
              <a href="costos.html"
                ><i class="fas fa-chart-pie fa-fw"></i> Costos</a
              >
            </li>
            <li>
              <a href="reportes.html"
                ><i class="fas fa-chart-line fa-fw"></i> Reportes</a
              >
            </li>
            <li class="active">
              <a href="analisis.html"
                ><i class="fas fa-brain fa-fw"></i> Análisis</a
              >
            </li>
          </ul>
        </nav>
        <div class="sidebar-footer">
          <button id="btnCerrarSesion" class="logout-btn">
            <i class="fas fa-sign-out-alt fa-fw"></i> Cerrar Sesión
          </button>
        </div>
      </aside>

      <main class="admin-main-content">
        <div class="section-heading">
          <h2>Análisis Financiero Anual</h2>
          <div class="divider"></div>
          <p>
            Visión estratégica del rendimiento mensual y anual de la empresa.
          </p>
        </div>

        <!-- Encabezado con Año Seleccionado -->
        <div class="analysis-header">
          <div>
            <span
              style="
                color: var(--text-secondary);
                text-transform: uppercase;
                letter-spacing: 2px;
              "
              >Viendo Año</span
            >
            <div id="display-year" class="current-year-display">----</div>
          </div>
          <div style="text-align: right">
            <p style="margin: 0; color: var(--text-secondary)">
              Rentabilidad Anual
            </p>
            <h3
              id="year-profitability"
              style="margin: 0; font-size: 1.8rem; color: var(--success-color)"
            >
              --%
            </h3>
          </div>
        </div>

        <!-- 1. Las 12 Tarjetas (Monitor Mensual) -->
        <div id="months-grid" class="months-grid">
          <!-- Se llena con JS -->
        </div>

        <!-- 2. Gráfico de Tendencia -->
        <div class="card">
          <h3>
            <i class="fas fa-chart-area"></i> Tendencia de Crecimiento
            (Acumulado)
          </h3>
          <div class="chart-container">
            <canvas id="trend-chart"></canvas>
          </div>
        </div>

        <!-- 3. Lista Histórica (Archivo Anual) -->
        <div class="card-table modern-table">
          <h3>
            <i class="fas fa-history"></i> Historial Anual (Selecciona un año
            para ver detalles)
          </h3>
          <div class="table-responsive">
            <table id="historical-table">
              <thead>
                <tr>
                  <th>Año</th>
                  <th>Venta Bruta</th>
                  <th>Gasto Total</th>
                  <th>Ganancia Neta</th>
                  <th>Rentabilidad</th>
                  <th>Mes Estrella</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <!-- Se llena con JS -->
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <!-- Scripts de Firebase -->
    <script src="/__/firebase/8.10.1/firebase-app.js"></script>
    <script src="/__/firebase/8.10.1/firebase-auth.js"></script>
    <script src="/__/firebase/init.js"></script>

    <!-- Scripts de la aplicación -->
    <script src="/admin/js/auth.js"></script>
    <script src="/admin/js/analisis.js"></script>
  </body>
</html>
